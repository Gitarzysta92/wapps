<tui-multi-select
  [placeholder]="placeholder"
  [ngModel]="selectedOptions"
  (ngModelChange)="change.emit($event)"
  [identityMatcher]="identityMatcher"
  [stringify]="stringifyItem"
  [tuiTextfieldLabelOutside]="true"
  (searchChange)="searchChange($event)"
>
  <tui-data-list *tuiDataList>
    @let searchResults = searchResults$ | async;
    @if (searchResults) {
      <tui-opt-group [label]="groupLabel" tuiMultiSelectGroup>
        <button
          *ngFor="let item of searchResults"
          tuiOption
          type="button"
          [value]="item"
        >
          <span [style.flex]="1">{{ item.name }}</span>
        </button>
      </tui-opt-group>
    } @else {
      @let items = allOptions$ | async;
      <tui-opt-group [label]="groupLabel" tuiMultiSelectGroup>
        <button *ngFor="let item of items" tuiOption type="button" [value]="item">
          <span [style.flex]="1">{{ item.name }}</span>
        </button>
      </tui-opt-group>
    }
  </tui-data-list>
</tui-multi-select>

