<ui-page-header class="page-header">
  @if (discussion.isLoading() || app.isLoading()) {
    <ui-breadcrumbs-skeleton class="breadcrumbs-skeleton" slot="top-bar" />
  } @else {
    <ui-breadcrumbs
      class="breadcrumbs"
      slot="top-bar"
      [breadcrumbs]="breadcrumbData()">
    </ui-breadcrumbs>
  }

  @if (discussion.isLoading()) {
    <ui-page-title-skeleton class="page-title-skeleton" slot="title" />
  } @else {
    <h1 uiPageTitle class="page-title" slot="title">{{ discussion.value()?.title }}</h1>
  }

  @if (discussion.isLoading()) {
    <ui-page-meta-skeleton slot="meta" />
  } @else {
    <ui-page-meta slot="meta">
    <!-- TODO: it should be mapped outside template -->
    <discussion-stats-badge
        class="discussion-stats-badge"
        [stats]="{ participants: discussion.value()?.repliesCount ?? 1, views: discussion.value()?.viewsCount ?? 1 }" />
    </ui-page-meta>
  }
</ui-page-header>

<section class="discussion-tags">
  @if (discussion.value(); as topic ) {
    <ui-tags [tags]="topic?.tags ?? []" />
  } @else if (discussion.isLoading()) {
    <ui-tags-skeleton />
  } @else {
    <p>Brak tagów do wyświetlenia</p>
  }
</section>

<section class="discussion-content">
  @if (discussion.value(); as topic) {
    <ui-discussion-thread>
      <!-- Opening Post (the thread itself is the opening post) -->
      <ui-discussion-post slot="opening-post" [post]="topic">
        <ui-discussion-post-header 
          slot="header"
          [authorName]="topic.author.name"
          [authorAvatarUrl]="topic.author.avatar.url"
          [publishedTime]="topic.publishedTime">
          <div slot="user-badges"></div>
        </ui-discussion-post-header>
        <ui-discussion-expandable-post-content slot="content" [content]="topic.content" />
        <ui-discussion-voting-button slot="bottom-bar" />
        <ui-discussion-reply-button slot="bottom-bar" />
      </ui-discussion-post>

      <!-- Replies -->
      <ui-discussion-post 
        *ngFor="let reply of topic.replies" 
        slot="reply" 
        [post]="$any(reply)">
        <ui-discussion-post-header 
          slot="header"
          [authorName]="$any(reply).author.name"
          [authorAvatarUrl]="$any(reply).author.avatar.url"
          [publishedTime]="$any(reply).publishedTime">
          <div slot="user-badges"></div>
        </ui-discussion-post-header>
        <ui-discussion-expandable-post-content slot="content" [content]="$any(reply).content" />
        <ui-discussion-voting-button slot="bottom-bar" />
        <ui-discussion-reply-button slot="bottom-bar" />
      </ui-discussion-post>
    </ui-discussion-thread>
  }
</section>



@if (discussion.isLoading() || app.isLoading()) {
  <ui-page-header-skeleton class="page-header">
    <ui-breadcrumbs-skeleton slot="top-bar" />
    <ui-page-title-skeleton slot="title" />
    <ui-page-meta-skeleton slot="meta" />
  </ui-page-header-skeleton>  
} @else {
 


}

@if (discussion.value(); as topic) {
  <div class="page-layout">
    <!-- Main Content -->
    <div class="content-layout">
      <main class="main-content">
        <!-- Discussion Content -->
        <section class="discussion-content-section">
    
        </section>

        <!-- Related Discussions -->
        <div class="aside-card">
          <h3 class="card-title">Related Discussions</h3>
          <div class="card-content">
            <div class="related-discussion" *ngFor="let discussion of ['API Rate Limiting', 'OAuth Implementation', 'Error Handling Best Practices']">
              <h4 class="related-title">{{ discussion }}</h4>
              <span class="related-stats">5 replies</span>
            </div>
          </div>
        </div>

        <!-- Discussion Actions -->
        <div class="aside-card">
          <h3 class="card-title">Actions</h3>
          <div class="card-content">
            <button tuiButton appearance="secondary" size="s" class="full-width-btn">
              <tui-icon icon="@tui.heart"></tui-icon>
              Follow Discussion
            </button>
            <button tuiButton appearance="secondary" size="s" class="full-width-btn">
              <tui-icon icon="@tui.share"></tui-icon>
              Share
            </button>
            <button tuiButton appearance="secondary" size="s" class="full-width-btn">
              <tui-icon icon="@tui.flag"></tui-icon>
              Report
            </button>
          </div>
        </div>
      </main>
    </div>
  </div>
}
