<ui-page-header class="page-header">
  <ui-breadcrumbs
    slot="top-bar"
    [breadcrumbs]="breadcrumb()">
  </ui-breadcrumbs>

  <h1 uiPageTitle slot="title">Display & Content Preferences</h1>

  <p slot="meta" class="page-description">
    Customize how content is displayed and organized
  </p>
</ui-page-header>

@if (isError()) {
  <section class="error-section">
    <p>Error loading preferences. Please try again.</p>
  </section>
} @else {
  <section class="settings-content">
    <!-- Display Settings -->
    <div
      tuiAppearance="floating"
      tuiCardLarge
      class="settings-card"
    >
      <header tuiHeader>
        <h2 class="section-title">
          <span tuiAppearance="accent-bar-indigo" class="accent-bar"></span>
          <tui-icon icon="@tui.palette" class="section-icon" />
          Display Settings
        </h2>
      </header>

      <div class="settings-group">
        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Theme</h3>
            <p class="setting-description">Choose your preferred color scheme</p>
          </div>
          <div class="setting-control theme-control">
            @for (option of themeOptions; track option.value) {
              <button
                tuiButton
                size="s"
                [appearance]="displayPreferences().theme === option.value ? 'primary' : 'secondary'"
                (click)="onThemeChange(option.value)"
              >
                {{ option.label }}
              </button>
            }
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Date Format</h3>
            <p class="setting-description">How dates should be displayed</p>
          </div>
          <div class="setting-control">
            @for (option of dateFormatOptions; track option.value) {
              <button
                tuiButton
                size="s"
                [appearance]="displayPreferences().dateFormat === option.value ? 'primary' : 'secondary'"
                (click)="onDateFormatChange(option.value)"
              >
                {{ option.label }}
              </button>
            }
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Default View</h3>
            <p class="setting-description">Preferred layout for listings</p>
          </div>
          <div class="setting-control">
            @for (option of viewModeOptions; track option.value) {
              <button
                tuiButton
                size="s"
                [appearance]="displayPreferences().defaultView === option.value ? 'primary' : 'secondary'"
                [iconStart]="option.value === 'grid' ? '@tui.layout-grid' : '@tui.list'"
                (click)="onViewModeChange(option.value)"
              >
                {{ option.label }}
              </button>
            }
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Items Per Page</h3>
            <p class="setting-description">Number of items shown in listings</p>
          </div>
          <div class="setting-control">
            @for (option of itemsPerPageOptions; track option) {
              <button
                tuiButton
                size="s"
                [appearance]="displayPreferences().itemsPerPage === option ? 'primary' : 'secondary'"
                (click)="onItemsPerPageChange(option)"
              >
                {{ option }}
              </button>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Content Settings -->
    <div
      tuiAppearance="floating"
      tuiCardLarge
      class="settings-card"
    >
      <header tuiHeader>
        <h2 class="section-title">
          <span tuiAppearance="accent-bar-warm" class="accent-bar"></span>
          <tui-icon icon="@tui.file-text" class="section-icon" />
          Content Settings
        </h2>
      </header>

      <div class="settings-group">
        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Default Feed Sort</h3>
            <p class="setting-description">How content should be sorted by default</p>
          </div>
          <div class="setting-control">
            @for (option of feedSortOptions; track option.value) {
              <button
                tuiButton
                size="s"
                [appearance]="contentPreferences().feedSortOrder === option.value ? 'primary' : 'secondary'"
                (click)="onFeedSortChange(option.value)"
              >
                {{ option.label }}
              </button>
            }
          </div>
        </div>

        <div class="setting-item setting-item--toggle">
          <div class="setting-info">
            <h3 class="setting-label">Show Mature Content</h3>
            <p class="setting-description">Display content marked as mature or adult-oriented</p>
          </div>
          <div class="setting-control">
            <input
              type="checkbox"
              tuiSwitch
              [ngModel]="contentPreferences().showMatureContent"
              (ngModelChange)="onMatureContentToggle($event)"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="settings-actions">
      <button
        tuiButton
        appearance="secondary"
        type="button"
        (click)="onCancel()"
      >
        Reset to Defaults
      </button>
      <button
        tuiButton
        appearance="primary"
        type="button"
        [disabled]="isSaving()"
        (click)="onSave()"
      >
        @if (isSaving()) {
          Saving...
        } @else {
          Save Changes
        }
      </button>
    </div>
  </section>
}
