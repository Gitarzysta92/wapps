  <section class="section__filters">
  <filters-bar></filters-bar>
</section>

<section class="section__separator"></section>

@let resultsData = resultsData$ | async;

@if (resultsData && !resultsData.isLoading) {
  @for (group of resultsData.groups; track group.type) {
    <section 
      class="section__results" 
      [id]="group.type"
      (appIntersect)="onVisibilityChange($event.isVisible, $event.element, group)">
      <div class="group-header">
        <h3>
          {{ group.type }}
          <span class="group-count">{{ group.entries.length }} items</span>
        </h3>
        <button 
          tuiButton 
          appearance="primary" 
          size="xs">
          Load more
        </button>
      </div>
      <div class="items-grid">
        @for (entry of group.entries; track entry.name) {
          @switch (group.type) {
            @case (DiscoverySearchResultType.Article) {
              <ng-container *ngTemplateOutlet="articleTile; context: { entry }"></ng-container>
            }
            @case (DiscoverySearchResultType.Application) {
              <ng-container *ngTemplateOutlet="applicationTile; context: { entry }"></ng-container>
            }
            @case (DiscoverySearchResultType.Suite) {
              <ng-container *ngTemplateOutlet="suiteTile; context: { entry }"></ng-container>
            }
          }
        }
      </div>
    </section>
  }
}
@else {
  @for (groupType of [
    DiscoverySearchResultType.Suite, 
    DiscoverySearchResultType.Article, 
    DiscoverySearchResultType.Application
  ]; track groupType) {
    <section class="section__results">
      <div class="group-header">
        <h3 [tuiSkeleton]="true" style="width: 100px; height: 25px;"></h3>
        <button tuiButton size="xs" [tuiSkeleton]="true" style="width: 100px; height: 25px;"></button>
      </div>
      <div class="items-grid">
        @for (entry of [1, 2, 3]; track entry) {
          @switch (groupType) {
            @case (DiscoverySearchResultType.Article) {
              <article-result-tile-skeleton class="item-card-skeleton"></article-result-tile-skeleton>
            }
            @case (DiscoverySearchResultType.Application) {
              <application-result-tile-skeleton class="item-card-skeleton"></application-result-tile-skeleton>
            }
            @case (DiscoverySearchResultType.Suite) {
              <suite-result-tile-skeleton class="item-card-skeleton"></suite-result-tile-skeleton>
            }
          }
        }
      </div>
    </section>
  }
}

<ng-template #articleTile let-entry="entry">
  <article-result-tile
    class="item-card" 
    [item]="toArticleVM(entry)">
  </article-result-tile>
</ng-template>

<ng-template #applicationTile let-entry="entry">
  <application-result-tile
    class="item-card"
    [item]="toApplicationVM(entry)">
  </application-result-tile>
</ng-template>

<ng-template #suiteTile let-entry="entry">
  <suite-result-tile
    routerLink=""
    class="item-card"
    [item]="toSuiteVM(entry)">
    <div name="actions">
      <button
        tuiButton
        appearance="flat"
        iconStart="@tui.heart"
        size="s"
        appearance="primary"
        (click)="$event.preventDefault(); $event.stopPropagation(); onSaveSuite(entry)">
      </button>
    </div>
  </suite-result-tile>
</ng-template>




<!-- 
<ng-container *ngFor="let groups of resultsData.groups; let isFirst = first; let isLast = last">    
  <ng-container *ngFor="let group of pageData.data.groups">
    <section 
      class="section__results" 
      [id]="getSectionId(group.type)"
      #suitesSection
      [attr.data-section]="'suites'">
      <div class="group-header">
        <h3 [ngSwitch]="group.type">
          <ng-container *ngSwitchCase="DiscoverySearchResultType.Article">Articles</ng-container>
          <ng-container *ngSwitchCase="DiscoverySearchResultType.Suite">Suites</ng-container>
          <ng-container *ngSwitchCase="DiscoverySearchResultType.Application">Applications</ng-container>
        </h3>
        <span class="gount">{{ group.entries.length }} items</span>
      </div> 
      <div class="items-grid">
        <div *ngFor="let entry of group.entries" class="item-card">
          <h4>{{ entry.name }}</h4>
          <div class="item-meta">
            <ng-container [ngSwitch]="group.type">
              <ng-container *ngSwitchCase="DiscoverySearchResultTypcle">
                <span class=">Article</span>
                <span>by {{ icle(entry).authorName }}</span>
          <span>ðŸ’¬ {{ .commentsNumber }}</span>
        </ng-container>
        <ng-container *ngSwitchCase="DiscoverySearchResultType.Suite">
                <span class="type-badge">Suite</span>
                <span>{{ asSuite(entry).numberOfApps }} apps</span>
                <span>by {{ asSuite(entry).authorName }}</span>
                <span>ðŸ’¬ {{ entry.commentsNumber }}</span>
              </ng-container>
              <ng-container *ngSwitchCase="DiscoverySearchResultType.Application">
                <span class="type-badge">Application</span>
                <span class="category">{{ asApplication(entry).category.name }}</span>
                <span class="rating">â˜… {{ asApplication(entry).rating.toFixed(1) }}</span>
                <span>ðŸ’¬ {{ entry.commentsNumber }}</span>
              </ng-container>
            </ng-container>
          </div>
        </div>
      </div>
    </section>
  </ng-container>
</ng-container> -->