<section class="filters-section">  
  <button
    class="add-filter-button"
    tuiButton
    type="button"
    size="s"
    appearance="primary"
    iconStart="@tui.funnel-plus"
    [tuiDropdown]="addFilterDropdown"
    [(tuiDropdownOpen)]="addFilterDropdownOpen">
    Manage filters
  </button>
  <ng-template #addFilterDropdown>
    <div class="dropdown-panel">
      <filters-multiselect 
        [availableFilters]="availableFiltersOptions$ | async"
        [activeFilters]="activeFiltersOptions$ | async"
        (activated)="onActivateFilter($event)"
        (deactivated)="onDeactivateFilter($event)">
      </filters-multiselect>
    </div>
  </ng-template>

  @let filters = filters$ | async;
  @for (f of filters; track f.key) {
    <selected-filter-chip 
      [name]="f.name" 
      [selectedOptions]="f.options"
      (open)="onOpenFilterDropdown(f.key)"
      (close)="onCloseFilterDropdown(f.key)"
      (remove)="onDeactivateFilter(f.key)"
      [tuiDropdown]="filterDropdownTemplate"
      [(tuiDropdownOpen)]="openFilterDropdowns[f.key]"
    >
      <ng-template #filterDropdownTemplate>
        <div class="dropdown-panel">
          @switch (f.key) {
            @case (FILTERS.category) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [placeholder]="'Search categories...'"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)">
              </multiselect-list>
            }
            @case (FILTERS.platform) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)">
              </multiselect-list>
            }
            @case (FILTERS.device) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [placeholder]="'Search devices...'"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)"
              />
            }
            @case (FILTERS.monetization) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [placeholder]="'Search monetization...'"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)"
              />
            }
            @case (FILTERS.social) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [placeholder]="'Search social...'"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)"
              />
            }
            @case (FILTERS.estimatedUsers) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [placeholder]="'Search user ranges...'"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)"
              />
            }
            @case (FILTERS.tag) {
              <multiselect-list
                [items]="FILTERS_OPTIONS_DICTIONARY[f.key]"
                [selectedOptions]="f.options"
                [placeholder]="'Search tags...'"
                [groupLabel]="f.name"
                (selectionChange)="onFilterSelectionChange(f.key, $event)"
              />
            }
            @case (FILTERS.search) {
              <text-search-input
                [selectedOptions]="f.options"
                [placeholder]="'Search...'"
                (change)="onFilterSelectionChange(f.key, $event)"
              />
            }
            @default {
              <p>Unknown filter: {{ f.key }}</p>
            }
          }
        </div>
      </ng-template>
    </selected-filter-chip>
  }
</section>


<!-- 
<section class="container">
  <div class="results-header">
    <h2>Results ({{ items.length }} items)</h2>
    <div *ngIf="config.showSorting" class="sorting-controls">
      <sorting-select (onUpdate)="sortingParam.next($event)"></sorting-select>
      <p>Sort options would go here</p>
    </div>
  </div>
  
  <div *ngIf="config.showListing" class="listing-section">
    <app-listing (onUpdate)="listingParams.next($event)"></app-listing>
    <div class="items-grid">
      <a *ngFor="let item of items" [routerLink]="['/', item.id]" class="item-card">
        <h3>{{ item.name }}</h3>
        <p class="description">{{ item.description }}</p>
        <div class="item-meta">
          <span class="category">{{ item.category }}</span>
          <span class="rating">â˜… {{ item.rating }}</span>
        </div>
      </a>
    </div>
    
    <div class="pagination">
      <button tuiButton appearance="secondary" [disabled]="currentPage === 1">Previous</button>
      <span class="page-info">Page {{ currentPage }} of {{ totalPages }}</span>
      <button tuiButton appearance="secondary" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </div>
</section> -->
