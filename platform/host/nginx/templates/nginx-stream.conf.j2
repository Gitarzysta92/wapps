# Nginx stream configuration for TCP proxying
# Generated by Ansible - do not edit manually
# This file must be included in /etc/nginx/nginx.conf
# Add this line to nginx.conf: include /etc/nginx/conf.d/stream.conf;

# RabbitMQ AMQP - TCP proxy via NodePort
# External access: <host-ip>:5672 -> localhost:30567 (NodePort) -> rabbitmq.rabbitmq:5672
# The RabbitMQ service is patched to NodePort 30567 via kustomization overlay
stream {
    upstream rabbitmq_amqp {
        server 127.0.0.1:30567;
    }

    server {
        listen 5672;
        proxy_pass rabbitmq_amqp;
        proxy_timeout 1s;
        proxy_responses 1;
        error_log /var/log/nginx/rabbitmq-amqp.error.log;
    }
}

